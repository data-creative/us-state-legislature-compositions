<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>US State Legislature Compositions</title>
    <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />
    <!--link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"-->
    <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
    <!--script src='https://www.mapbox.com/mapbox.js/assets/data/us-states.js'></script-->
  </head>
  <body>
    <h1 style="display:inline-block;">
      US State Legislature Compositions
      in <span id="year-display">2009</span>
    </h1>
    <div id="year-input-group">
      <label for="year-slider">Select a Year:</label>
      <span>2009</span>
      <input type="range" id="year-slider" min=2009 max=2016 value=2009 step=1 defaultValue=2009>
      <span>2016</span>

      <button type="button" id="year-play">
        <i class="fa fa-play" aria-hidden="true"></i>
      </button>
      <button type="button" id="year-pause">
        <i class="fa fa-pause" aria-hidden="true"></i>
      </button>
      <button type="button" id="year-restart">
        <i class="fa fa-fast-backward" aria-hidden="true"></i>
      </button>

    </div>

    <div id="map-container" style="height:40em; border:1px solid #000; margin:2em;"></div>
    <div id="map-footer">
      <p>
        <a href="http://data-creative.github.io/us-state-legislature-compositions/">view</a> |
        <a href="https://github.com/data-creative/us-state-legislature-compositions">source</a> |
        <a href="https://github.com/dwillis/state_legislatures">data</a>
      </p>
    </div>

    <script src='data/mapbox/us-states.js'></script>
    <script src='https://d3js.org/colorbrewer.v1.min.js'></script>
    <script src="https://use.fontawesome.com/4fbdaa660e.js"></script>
    <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript">

        //
        // MAP
        //

        L.mapbox.accessToken = 'pk.eyJ1IjoiczJ0MiIsImEiOiJQVFE0UW1JIn0.0MfEvAJVxFx7BLGoL0USXA';
        function logMapClick(cc){ console.log("MAP CLICKED ON GEOLOCATION: [" + cc.latlng.lat + ", " + cc.latlng.lng + "]"); };
        function logMapView(){ console.log("MAP VIEW: [" + map.getCenter().lat + ", " + map.getCenter().lng + "], " + map.getZoom()); };

        var map = L.mapbox.map('map-container', 'mapbox.streets', {scrollWheelZoom:false})
          .setView([40.111688665595956, -97.3388671875], 4)
          .on("click", logMapClick)
          .on("dragend", logMapView)
          .on("zoomend", logMapView);

        statesData.features.forEach(function(feature){ // includes all states plus DC and PR
          var stateName = feature.properties.name;
          var popupContent = "<strong>State</strong>: " + stateName + "<br/>";
          var state = L.geoJson(feature, {
              style: {
                fillColor: 'steelblue',
                color: "#fff",
                weight: 1.5,
                opacity: .85,
                fillOpacity: .75,
                className: 'geojson state ' + stateName
              }
          });
          state.bindPopup(popupContent);
          map.addLayer(state);
        });

        //
        // CONTROLS
        //

        // YEAR

        var yearDisplay = document.getElementById("year-display");
        var inputYear = document.getElementById('year-slider');

        inputYear.addEventListener("change", displayYear, false);

        function displayYear(){
          console.log("YEAR: " + inputYear.value);
          yearDisplay.innerHTML = inputYear.value;
        };

        displayYear();

        // PLAY

        var playButton = document.getElementById("year-play");

        playButton.addEventListener("click", playYears, false);

        var playIntervalId;

        function playYears(){
          console.log("PLAY FROM", inputYear.value);

          playIntervalId = setInterval(function(){
            inputYear.stepUp();

            displayYear();
          }, 2500);
        };

        // PAUSE

        var pauseButton = document.getElementById("year-pause");

        pauseButton.addEventListener("click", pauseYears, false);

        function pauseYears(){
          console.log("PAUSE", inputYear.value)

          clearInterval(playIntervalId);

          playIntervalId = null;
        };

        // START OVER

        var restartButton = document.getElementById("year-restart");

        restartButton.addEventListener("click", restartYears, false);

        function restartYears(){
          console.log("RESTART", inputYear.value, "TO", inputYear.defaultValue);

          pauseYears();

          inputYear.value = inputYear.defaultValue;

          playYears();
        };



    </script>
  </body>
</html>
